/*!
 * Bootstrap 4 integration for DataTables' Responsive
 * Â© SpryMedia Ltd - datatables.net/license
 */
!(function (factory) {
    var jQuery, setup;

    if (typeof define === "function" && define.amd) {
        // AMD
        define(["jquery", "datatables.net-bs4", "datatables.net-responsive"], function ($) {
            return factory($, window, document);
        });
    } else if (typeof exports === "object") {
        // CommonJS
        jQuery = require("jquery");
        setup = function ($, window) {
            if (!$.fn.dataTable) require("datatables.net-bs4")($, window);
            if (!$.fn.dataTable.Responsive) require("datatables.net-responsive")($, window);
        };

        if (typeof window === "undefined") {
            module.exports = function (root, $) {
                root = root || window;
                $ = $ || jQuery(root);
                setup($, root);
                return factory($, 0, root.document);
            };
        } else {
            setup(window, jQuery);
            module.exports = factory(jQuery, window, window.document);
        }
    } else {
        // Browser globals
        factory(jQuery, window, document);
    }
})(function ($, window, document, undefined) {
    "use strict";

    var DataTable = $.fn.dataTable;
    var ResponsiveDisplay = DataTable.Responsive.display;
    var modalDisplay = ResponsiveDisplay.modal;

    // Define the Bootstrap modal
    var modal = $(
        '<div class="modal fade dtr-bs-modal" role="dialog">' +
            '<div class="modal-dialog" role="document">' +
                '<div class="modal-content">' +
                    '<div class="modal-header">' +
                        '<button type="button" class="close" data-dismiss="modal" aria-label="Close">' +
                            '<span aria-hidden="true">&times;</span>' +
                        '</button>' +
                    '</div>' +
                    '<div class="modal-body"/>' +
                '</div>' +
            '</div>' +
        '</div>'
    );

    // Override modal function
    ResponsiveDisplay.modal = function (options) {
        return function (api, row, render, closeCallback) {
            if (!$.fn.modal) {
                return modalDisplay(api, row, render, closeCallback);
            }

            if (row) {
                if (!$.contains(document, modal[0]) || api.index() !== modal.data("dtr-row-idx")) {
                    return null;
                }
                modal.find("div.modal-body").empty().append(render());
            } else {
                var header, headerContent;

                if (options && options.header) {
                    header = modal.find("div.modal-header");
                    headerContent = header.find("button").detach();
                    header.empty().append('<h4 class="modal-title">' + options.header(api) + "</h4>").append(headerContent);
                }

                modal.find("div.modal-body").empty().append(render());
                modal
                    .data("dtr-row-idx", api.index())
                    .one("hidden.bs.modal", closeCallback)
                    .appendTo("body")
                    .modal();
            }

            return true;
        };
    };

    return DataTable;
});
